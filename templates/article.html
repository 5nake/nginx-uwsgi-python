<h1>{{ article_title }}</h1>
<div>
{{ article_text|safe }}
</div>
<div>Date: {{ article_date }}</div>
<div>Author: {{ article_author }}</div>

{% if name %}
<form id="second_form" autocomplete="off">

<div class="form-group" style="padding-top:18px;">
    <textarea type="text" id = "comment_input" class="form-control status-box-text" rows="2" placeholder="What's on your mind?" required></textarea>
</div>
<button type="submit" id="addcomment" class="btn btn-success">Post</button>
</form>
{% endif %}

<hr>
<div style="padding-top:20px;">
<h4>Comments:</h4>
</br>
<div id='content'>
{% for comment in comments %}
<form id="comment_form">
<span>{{ comment['comment_text'] }}</span><br/>
<span>{{ comment['comment_author'] }}</span>
<span>{{ comment['comment_date'] }}</span><br/>
<p id='comment_id' hidden>{{ comment['comment_id'] }}</p>
{% if comment['comment_author'] == name %}
<button type="submit" onclick="delete_comment()">Delete</button>
{% endif %}
</form>
<br/><br/>
{% endfor %}
</div>
</div>

{% if comments|length > 4 %}
<div id="show_more_comments" class="btn btn-primary">Show More</div>
{% endif %}

<script>
$(document).ready(function(){
	$('form#second_form').on('submit', function() {
		var comment_text = $("#comment_input").val();
		function parse(str) {
    		var args = [].slice.call(arguments, 1),
 				i = 0;

    		return str.replace(/%s/g, function() {
        		return args[i++];
    		});
		}
		$.post("/add/comment/add/", { comment_text: comment_text, location: window.location.pathname.substr(1) },
			function(data){
    			if (data.status === "error") {
					alert(data.error);
					window.location.href = ("/")
				} else if (data.status === "ok") {
					s = parse('%s<br>%s %s<br><a href=#>Edit</a> <span style="padding-left:30px";><a href=# id="deletecomm">Delete</a></span><br/><br/>', data.comment_text, data.comment_author, data.comment_date);
					var div = document.createElement('div');
					div.innerHTML = s;
					newParent = document.getElementById('content');
					newParent.insertBefore(div, newParent.firstChild);
				}}, "json");
	return false;
	});
});
</script>

<script>
$(document).ready(function(){
	var counter = 0
	var button = document.getElementById('show_more_comments')
	function parse(str) {
    	var args = [].slice.call(arguments, 1),
 			i = 0;
    	return str.replace(/%s/g, function() {
        	return args[i++];
    	});
	};
	$("#show_more_comments").click(function() {
		counter += 5;
		$.post("/showmore/comments/", { counter: counter, location: window.location.pathname.substr(1) },
			function(data) {
				if (data.data == 'last_data') {
					button.parentNode.removeChild(button)
				}
				if (data.status === 'error') {
					alert(data.error);
				} else if (data.status === 'ok') {
					if (data.response.length < 5) {
						button.parentNode.removeChild(button)
					}; for (var i=0; i<data.response.length; i++) {
					s = parse('%s<br>%s %s<br><a href=#>Edit</a> <span style="padding-left:30px";><a href=# id="deletecomm">Delete</a></span><br/><br/>', data.response[i].comment_text, data.response[i].comment_author, data.response[i].comment_date);
					var div = document.createElement('div');
					div.innerHTML = s;
					newParent = document.getElementById('content');
					newParent.appendChild(div);
					};
			}}, "json");
	});
});
</script>

<script>
function delete_comment() {
	$('form#comment_form').on('submit', function() {
		replace_elem = "<p style='color:red; font-style:italic'>Comment deleted!</p>"
		$(this).replaceWith(replace_elem);
		var comment_id = this.getElementsByTagName("p")[0].innerHTML;	
		$.post("/delete/comment/", {'comment_id': comment_id});
	});
};
</script>
